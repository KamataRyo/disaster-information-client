(function() {
  var DEFAULT_LANG, ENDPOINT_BASE, FALLBACK_LANG, LANGUAGE_LABELS, RESPONSE_FORMAT, app;

  ENDPOINT_BASE = "http://api.c4w.jp/api/v1/";

  RESPONSE_FORMAT = 'json';

  DEFAULT_LANG = 'ja';

  FALLBACK_LANG = 'en';

  LANGUAGE_LABELS = {
    ja: '日本語',
    en: 'English'
  };

  app = angular.module('disaster-information-client', ['pascalprecht.translate', 'ngSanitize']);

  app.config([
    '$translateProvider', function($translateProvider) {
      $translateProvider.useStaticFilesLoader({
        prefix: 'language/',
        suffix: '.json'
      });
      $translateProvider.useSanitizeValueStrategy(null);
      $translateProvider.preferredLanguage(DEFAULT_LANG);
      return $translateProvider.fallbackLanguage(FALLBACK_LANG);
    }
  ]);

  app.run([
    'acquireLocales', 'acquireEntries', '$rootScope', function(acquireLocales, acquireEntries, $rootScope) {
      $rootScope.languageLabel = LANGUAGE_LABELS;
      $rootScope.err = false;
      return acquireLocales().then(function(locales) {
        $rootScope.locales = locales;
        $rootScope.selectedLocale = DEFAULT_LANG;
        $rootScope.entries = [];
        return locales;
      }).then(function(locales) {
        return acquireEntries(locales);
      }).then(function(entries) {
        $rootScope.entries = [];
        return entries.sort(function(a, b) {
          var date;
          date = function(x) {
            return Date.parse(x.date);
          };
          return date(b - date(a));
        }).forEach(function(obj) {
          return obj.forEach(function(entry) {
            entry.meta = JSON.stringify(entry.meta);
            return $rootScope.entries.push(entry);
          });
        });
      }).then(function() {
        return $rootScope.$emit('entriesLoaded', {
          status: 'success'
        });
      })["catch"](function(res) {
        console.log(res);
        return $rootScope.err = true;
      });
    }
  ]);

  app.service('getEndpoint', [
    function() {
      return function(key) {
        return "" + ENDPOINT_BASE + key + "." + RESPONSE_FORMAT;
      };
    }
  ]);

  app.service('acquireLocales', [
    'getEndpoint', '$http', '$q', function(getEndpoint, $http, $q) {
      var deferred;
      deferred = $q.defer();
      return function() {
        return $http.get(getEndpoint('locale')).then(function(res) {
          var locales;
          locales = res.data;
          deferred.resolve(locales);
          return deferred.promise;
        }, function(res) {
          deferred.reject(res);
          return deferred.promise;
        });
      };
    }
  ]);

  app.service('acquireEntries', [
    'getEndpoint', '$http', '$q', function(getEndpoint, $http, $q) {
      return function(locales) {
        return $q.all(locales.map(function(locale) {
          var deferred;
          deferred = $q.defer();
          return $http.get(getEndpoint(locale)).then(function(res) {
            var entries;
            entries = res.data.entries;
            entries.forEach(function(entry) {
              var rawDate;
              rawDate = Date.parse(entry.date);
              entry.date = new Date(rawDate).toLocaleDateString();
              entry.time = new Date(rawDate).toLocaleTimeString();
              return entry.body = entry.body;
            });
            deferred.resolve(entries);
            return deferred.promise;
          }, function(res) {
            deferred.reject(res);
            return deferred.promise;
          });
        }));
      };
    }
  ]);

  app.service('router', [
    '$location', '$rootScope', function($location, $rootScope) {
      return $rootScope.$on('entriesLoaded', function() {
        return $rootScope.$watch(function() {
          return $location.path();
        }, function(url) {
          var entry;
          if (url === '') {
            return $rootScope.$emit('entryUnselected');
          } else {
            entry = ($rootScope.entries.filter(function(entry) {
              return entry.url === url;
            }))[0];
            return $rootScope.$emit('entrySelected', {
              entry: entry
            });
          }
        });
      });
    }
  ]);

  app.controller('mainCtrl', [
    '$scope', function($scope) {
      $scope.entry = false;
      return $scope.$on('entryUnselected', function(event) {
        return $scope.entry = false;
      });
    }
  ]);

  app.directive('entryArchive', function() {
    return {
      restrict: 'E',
      transclude: true,
      replace: true,
      templateUrl: 'templates/entry-archive.html',
      controller: [
        'router', '$scope', function(router, $scope) {
          $scope.detag = function(html) {
            if (html != null) {
              return String(html).replace(/<[^>]+>/gm, '');
            } else {
              return '';
            }
          };
          return $scope.select = function(entry) {
            return $scope.$emit('entrySelected', {
              entry: entry
            });
          };
        }
      ]
    };
  });

  app.directive('singleEntry', function() {
    return {
      restrict: 'E',
      transclude: true,
      replace: true,
      templateUrl: 'templates/single-entry.html',
      controller: [
        '$scope', '$rootScope', function($scope, $rootScope) {
          $scope.unselect = function() {
            return $scope.entry = false;
          };
          $rootScope.$on('entrySelected', function(event, arg) {
            var entry;
            entry = arg.entry;
            return $scope.entry = entry;
          });
          return $rootScope.$on('entryUnselected', function(event) {
            return $scope.entry = false;
          });
        }
      ]
    };
  });

  app.directive('languageSwitch', function() {
    return {
      restrict: 'E',
      transclude: true,
      replace: true,
      templateUrl: 'templates/language-switch.html',
      controller: [
        '$translate', '$scope', '$rootScope', function($translate, $scope, $rootScope) {
          var changeLanguage;
          $scope.key = DEFAULT_LANG;
          changeLanguage = function(key) {
            $translate.use(key);
            $rootScope.selectedLocale = key;
            return $rootScope.entriesShim = $rootScope.entries.filter(function(entry) {
              return entry.lang === key;
            });
          };
          $scope.changeLanguage = changeLanguage;
          return $rootScope.$on('entriesLoaded', function() {
            $scope.key = $rootScope.selectedLocale;
            return changeLanguage($scope.key);
          });
        }
      ]
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,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LEtBQVAsR0FBZTtVQURhLENBQWhDO2lCQUVBLFVBQVUsQ0FBQyxHQUFYLENBQWUsaUJBQWYsRUFBa0MsU0FBQyxLQUFEO21CQUM5QixNQUFNLENBQUMsS0FBUCxHQUFlO1VBRGUsQ0FBbEM7UUFMSixDQUhRO09BTFQ7O0VBRGtCLENBQTdCOztFQW9CQSxHQUFHLENBQUMsU0FBSixDQUFjLGdCQUFkLEVBQWdDLFNBQUE7QUFDNUIsV0FBTztNQUNILFFBQUEsRUFBVSxHQURQO01BRUgsVUFBQSxFQUFZLElBRlQ7TUFHSCxPQUFBLEVBQVMsSUFITjtNQUlILFdBQUEsRUFBYSxnQ0FKVjtNQUtILFVBQUEsRUFBWTtRQUNSLFlBRFEsRUFFUixRQUZRLEVBR1IsWUFIUSxFQUlSLFNBQUMsVUFBRCxFQUFhLE1BQWIsRUFBcUIsVUFBckI7QUFDSSxjQUFBO1VBQUEsTUFBTSxDQUFDLEdBQVAsR0FBYTtVQUViLGNBQUEsR0FBaUIsU0FBQyxHQUFEO1lBQ2IsVUFBVSxDQUFDLEdBQVgsQ0FBZSxHQUFmO1lBQ0EsVUFBVSxDQUFDLGNBQVgsR0FBNEI7bUJBQzVCLFVBQVUsQ0FBQyxXQUFYLEdBQXlCLFVBQVUsQ0FBQyxPQUFPLENBQUMsTUFBbkIsQ0FBMEIsU0FBQyxLQUFEO3FCQUMvQyxLQUFLLENBQUMsSUFBTixLQUFjO1lBRGlDLENBQTFCO1VBSFo7VUFNakIsTUFBTSxDQUFDLGNBQVAsR0FBd0I7aUJBRXhCLFVBQVUsQ0FBQyxHQUFYLENBQWUsZUFBZixFQUFnQyxTQUFBO1lBQzVCLE1BQU0sQ0FBQyxHQUFQLEdBQWEsVUFBVSxDQUFDO21CQUN4QixjQUFBLENBQWUsTUFBTSxDQUFDLEdBQXRCO1VBRjRCLENBQWhDO1FBWEosQ0FKUTtPQUxUOztFQURxQixDQUFoQztBQTFMQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJFTkRQT0lOVF9CQVNFID0gXCJodHRwOi8vYXBpLmM0dy5qcC9hcGkvdjEvXCJcblJFU1BPTlNFX0ZPUk1BVCA9ICdqc29uJ1xuREVGQVVMVF9MQU5HID0gJ2phJ1xuRkFMTEJBQ0tfTEFORyA9ICdlbidcbkxBTkdVQUdFX0xBQkVMUyA9XG4gICAgamE6ICfml6XmnKzoqp4nXG4gICAgZW46ICdFbmdsaXNoJ1xuXG5hcHAgPSBhbmd1bGFyLm1vZHVsZSAnZGlzYXN0ZXItaW5mb3JtYXRpb24tY2xpZW50JywgW1xuICAgICdwYXNjYWxwcmVjaHQudHJhbnNsYXRlJ1xuICAgICduZ1Nhbml0aXplJ1xuXVxuXG5cbmFwcC5jb25maWcgW1xuICAgICckdHJhbnNsYXRlUHJvdmlkZXInXG4gICAgKCR0cmFuc2xhdGVQcm92aWRlcikgLT5cbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZVN0YXRpY0ZpbGVzTG9hZGVyIHtcbiAgICAgICAgICAgIHByZWZpeDogJ2xhbmd1YWdlLydcbiAgICAgICAgICAgIHN1ZmZpeDogJy5qc29uJ1xuICAgICAgICB9XG4gICAgICAgICR0cmFuc2xhdGVQcm92aWRlci51c2VTYW5pdGl6ZVZhbHVlU3RyYXRlZ3kgbnVsbFxuICAgICAgICAkdHJhbnNsYXRlUHJvdmlkZXIucHJlZmVycmVkTGFuZ3VhZ2UgREVGQVVMVF9MQU5HXG4gICAgICAgICR0cmFuc2xhdGVQcm92aWRlci5mYWxsYmFja0xhbmd1YWdlIEZBTExCQUNLX0xBTkdcbl1cblxuXG5hcHAucnVuIFtcbiAgICAnYWNxdWlyZUxvY2FsZXMnXG4gICAgJ2FjcXVpcmVFbnRyaWVzJ1xuICAgICckcm9vdFNjb3BlJ1xuICAgIChhY3F1aXJlTG9jYWxlcywgYWNxdWlyZUVudHJpZXMsICRyb290U2NvcGUpIC0+XG4gICAgICAgICMgc2V0dGluZ1xuICAgICAgICAkcm9vdFNjb3BlLmxhbmd1YWdlTGFiZWwgPSBMQU5HVUFHRV9MQUJFTFNcbiAgICAgICAgJHJvb3RTY29wZS5lcnIgPSBmYWxzZVxuXG4gICAgICAgIGFjcXVpcmVMb2NhbGVzKClcbiAgICAgICAgICAgIC50aGVuIChsb2NhbGVzKSAtPlxuICAgICAgICAgICAgICAgICRyb290U2NvcGUubG9jYWxlcyA9IGxvY2FsZXNcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnNlbGVjdGVkTG9jYWxlID0gREVGQVVMVF9MQU5HXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5lbnRyaWVzID0gW11cbiAgICAgICAgICAgICAgICByZXR1cm4gbG9jYWxlc1xuXG4gICAgICAgICAgICAudGhlbiAobG9jYWxlcykgLT5cbiAgICAgICAgICAgICAgICBhY3F1aXJlRW50cmllcyhsb2NhbGVzKVxuXG4gICAgICAgICAgICAudGhlbiAoZW50cmllcykgLT5cbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmVudHJpZXMgPSBbXVxuICAgICAgICAgICAgICAgICMgc29ydCBhbmQgZmxhdHRlblxuICAgICAgICAgICAgICAgIGVudHJpZXNcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQgKGEsIGIpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gKHgpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0ZS5wYXJzZSB4LmRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlIGIgLSBkYXRlIGFcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2ggKG9iaikgLT5cbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5mb3JFYWNoIChlbnRyeSkgLT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5tZXRhID0gSlNPTi5zdHJpbmdpZnkgZW50cnkubWV0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuZW50cmllcy5wdXNoIGVudHJ5XG5cbiAgICAgICAgICAgIC50aGVuIC0+XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCAnZW50cmllc0xvYWRlZCcsIHtzdGF0dXM6J3N1Y2Nlc3MnfVxuXG4gICAgICAgICAgICAuY2F0Y2ggKHJlcykgLT5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyByZXNcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmVyciA9IHRydWVcbl1cblxuXG5hcHAuc2VydmljZSAnZ2V0RW5kcG9pbnQnLCBbXG4gICAgLT5cbiAgICAgICAgKGtleSktPlxuICAgICAgICAgICAgXCIje0VORFBPSU5UX0JBU0V9I3trZXl9LiN7UkVTUE9OU0VfRk9STUFUfVwiXG5dXG5cblxuYXBwLnNlcnZpY2UgJ2FjcXVpcmVMb2NhbGVzJywgW1xuICAgICdnZXRFbmRwb2ludCdcbiAgICAnJGh0dHAnXG4gICAgJyRxJ1xuICAgIChnZXRFbmRwb2ludCwgJGh0dHAsICRxKSAtPlxuICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKCkgIyBtYWtlIGRlZmVyIGluc3RhbmNlXG4gICAgICAgIHJldHVybiAtPlxuICAgICAgICAgICAgJGh0dHAuZ2V0IGdldEVuZHBvaW50ICdsb2NhbGUnXG4gICAgICAgICAgICAgICAgLnRoZW4gKHJlcykgLT5cbiAgICAgICAgICAgICAgICAgICAgIyBpbml0aWFsaXphdGlvblxuICAgICAgICAgICAgICAgICAgICBsb2NhbGVzID0gcmVzLmRhdGFcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSBsb2NhbGVzXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlXG4gICAgICAgICAgICAgICAgLCAocmVzKSAtPlxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QgcmVzXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlXG5dXG5cblxuYXBwLnNlcnZpY2UgJ2FjcXVpcmVFbnRyaWVzJywgW1xuICAgICdnZXRFbmRwb2ludCdcbiAgICAnJGh0dHAnXG4gICAgJyRxJ1xuICAgIChnZXRFbmRwb2ludCwgJGh0dHAsICRxKSAtPlxuICAgICAgICByZXR1cm4gKGxvY2FsZXMpIC0+XG4gICAgICAgICAgICAkcS5hbGwgbG9jYWxlcy5tYXAgKGxvY2FsZSkgLT5cbiAgICAgICAgICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKClcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQgZ2V0RW5kcG9pbnQgbG9jYWxlXG4gICAgICAgICAgICAgICAgICAgIC50aGVuIChyZXMpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRyaWVzID0gcmVzLmRhdGEuZW50cmllc1xuICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoIChlbnRyeSkgLT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF3RGF0ZSA9IERhdGUucGFyc2UoZW50cnkuZGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmRhdGUgPSBuZXcgRGF0ZShyYXdEYXRlKS50b0xvY2FsZURhdGVTdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS50aW1lID0gbmV3IERhdGUocmF3RGF0ZSkudG9Mb2NhbGVUaW1lU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuYm9keSA9IGVudHJ5LmJvZHkgIyBuZWVkIHNhbml0aXphdGlvbj9cbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUgZW50cmllc1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2VcblxuICAgICAgICAgICAgICAgICAgICAsIChyZXMpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QgcmVzXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZVxuXVxuXG5cbmFwcC5zZXJ2aWNlICdyb3V0ZXInLCBbXG4gICAgJyRsb2NhdGlvbidcbiAgICAnJHJvb3RTY29wZSdcbiAgICAoJGxvY2F0aW9uLCAkcm9vdFNjb3BlKSAtPlxuICAgICAgICAkcm9vdFNjb3BlLiRvbiAnZW50cmllc0xvYWRlZCcsIC0+XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiR3YXRjaCAtPlxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKClcbiAgICAgICAgICAgICwgKHVybCkgLT5cbiAgICAgICAgICAgICAgICBpZiB1cmwgaXMgJydcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCAnZW50cnlVbnNlbGVjdGVkJ1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgZW50cnkgPSAoJHJvb3RTY29wZS5lbnRyaWVzLmZpbHRlciAoZW50cnkpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS51cmwgaXMgdXJsXG4gICAgICAgICAgICAgICAgICAgIClbMF1cbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCAnZW50cnlTZWxlY3RlZCcsIHtlbnRyeX1cbl1cblxuXG5hcHAuY29udHJvbGxlciAnbWFpbkN0cmwnLCBbXG4gICAgJyRzY29wZSdcbiAgICAoJHNjb3BlKSAtPlxuICAgICAgICAkc2NvcGUuZW50cnkgPSBmYWxzZVxuICAgICAgICAkc2NvcGUuJG9uICdlbnRyeVVuc2VsZWN0ZWQnLCAoZXZlbnQpIC0+XG4gICAgICAgICAgICAkc2NvcGUuZW50cnkgPSBmYWxzZVxuXG5dXG5cblxuYXBwLmRpcmVjdGl2ZSAnZW50cnlBcmNoaXZlJywgLT5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0UnXG4gICAgICAgIHRyYW5zY2x1ZGU6IHRydWVcbiAgICAgICAgcmVwbGFjZTogdHJ1ZVxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9lbnRyeS1hcmNoaXZlLmh0bWwnXG4gICAgICAgIGNvbnRyb2xsZXI6IFtcbiAgICAgICAgICAgICdyb3V0ZXInXG4gICAgICAgICAgICAnJHNjb3BlJ1xuICAgICAgICAgICAgKHJvdXRlciwgJHNjb3BlKSAtPlxuICAgICAgICAgICAgICAgICRzY29wZS5kZXRhZyA9IChodG1sKSAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgaHRtbD8gdGhlbiBTdHJpbmcoaHRtbCkucmVwbGFjZSgvPFtePl0rPi9nbSwgJycpIGVsc2UgJydcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ID0gKGVudHJ5KSAtPlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQgJ2VudHJ5U2VsZWN0ZWQnLCB7ZW50cnl9XG4gICAgICAgIF1cbiAgICB9XG5cblxuYXBwLmRpcmVjdGl2ZSAnc2luZ2xlRW50cnknLCAtPlxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnRSdcbiAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZVxuICAgICAgICByZXBsYWNlOiB0cnVlXG4gICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL3NpbmdsZS1lbnRyeS5odG1sJ1xuICAgICAgICBjb250cm9sbGVyOiBbXG4gICAgICAgICAgICAnJHNjb3BlJ1xuICAgICAgICAgICAgJyRyb290U2NvcGUnXG4gICAgICAgICAgICAoJHNjb3BlLCAkcm9vdFNjb3BlKSAtPlxuICAgICAgICAgICAgICAgICRzY29wZS51bnNlbGVjdCA9IC0+XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lbnRyeSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kb24gJ2VudHJ5U2VsZWN0ZWQnLCAoZXZlbnQsIHtlbnRyeX0pIC0+XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lbnRyeSA9IGVudHJ5XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kb24gJ2VudHJ5VW5zZWxlY3RlZCcsIChldmVudCkgLT5cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVudHJ5ID0gZmFsc2VcbiAgICAgICAgXVxuICAgIH1cblxuXG5hcHAuZGlyZWN0aXZlICdsYW5ndWFnZVN3aXRjaCcsIC0+XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdFJ1xuICAgICAgICB0cmFuc2NsdWRlOiB0cnVlXG4gICAgICAgIHJlcGxhY2U6IHRydWVcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvbGFuZ3VhZ2Utc3dpdGNoLmh0bWwnXG4gICAgICAgIGNvbnRyb2xsZXI6IFtcbiAgICAgICAgICAgICckdHJhbnNsYXRlJ1xuICAgICAgICAgICAgJyRzY29wZSdcbiAgICAgICAgICAgICckcm9vdFNjb3BlJ1xuICAgICAgICAgICAgKCR0cmFuc2xhdGUsICRzY29wZSwgJHJvb3RTY29wZSkgLT5cbiAgICAgICAgICAgICAgICAkc2NvcGUua2V5ID0gREVGQVVMVF9MQU5HXG5cbiAgICAgICAgICAgICAgICBjaGFuZ2VMYW5ndWFnZSA9IChrZXkpIC0+XG4gICAgICAgICAgICAgICAgICAgICR0cmFuc2xhdGUudXNlKGtleSlcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5zZWxlY3RlZExvY2FsZSA9IGtleVxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmVudHJpZXNTaGltID0gJHJvb3RTY29wZS5lbnRyaWVzLmZpbHRlciAoZW50cnkpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5sYW5nIGlzIGtleVxuXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYW5nZUxhbmd1YWdlID0gY2hhbmdlTGFuZ3VhZ2VcblxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJG9uICdlbnRyaWVzTG9hZGVkJywgLT5cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmtleSA9ICRyb290U2NvcGUuc2VsZWN0ZWRMb2NhbGVcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlTGFuZ3VhZ2UgJHNjb3BlLmtleVxuXG4gICAgICAgIF1cbiAgICB9XG4iXX0=
